Excelente pergunta! Vou fazer uma anÃ¡lise completa das diferenÃ§as entre DigitalOcean Kubernetes (Managed) vs Bare-Metal Kubernetes (Self-Hosted).

  ---
  ğŸ”„ O Que Muda no Workflow CI/CD

  Digital Ocean (Atual)

  - name: Install doctl
    uses: digitalocean/action-doctl@v2
    with:
      token: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}

  - name: Save kubeconfig
    run: doctl kubernetes cluster kubeconfig save ${{ secrets.K8S_CLUSTER_ID }}

  Bare-Metal (Novo)

  - name: Configure kubectl
    run: |
      mkdir -p ~/.kube
      echo "${{ secrets.KUBECONFIG_BASE64 }}" | base64 -d > ~/.kube/config
      chmod 600 ~/.kube/config

  DiferenÃ§a chave: Em bare-metal, vocÃª precisa gerenciar o kubeconfig manualmente e armazenÃ¡-lo como secret no GitHub.

  ---
  ğŸ–¥ï¸ Componentes para Instalar no Bare-Metal

  1. Sistema Operacional Base

  OpÃ§Ãµes recomendadas:
  - Ubuntu Server 22.04 LTS (mais popular)
  - Rocky Linux 9 (sucessor do CentOS)
  - Debian 12

  2. Plataforma Kubernetes

  VocÃª tem vÃ¡rias opÃ§Ãµes, dependendo da complexidade:

  OpÃ§Ã£o A: Kubeadm (Vanilla Kubernetes) â­ Recomendado para ProduÃ§Ã£o

  # InstalaÃ§Ã£o bÃ¡sica
  apt-get update && apt-get install -y apt-transport-https curl
  curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | \
    gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
  echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] \
    https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /' | \
    tee /etc/apt/sources.list.d/kubernetes.list
  apt-get update
  apt-get install -y kubelet kubeadm kubectl containerd
  kubeadm init --pod-network-cidr=10.244.0.0/16

  Componentes adicionais necessÃ¡rios:
  - Container Runtime: containerd ou CRI-O
  - Network Plugin: Calico, Flannel ou Cilium
  - Storage: Longhorn, OpenEBS, ou Rook-Ceph

  OpÃ§Ã£o B: K3s (Lightweight) â­ Recomendado para Dev/Small Prod

  # InstalaÃ§Ã£o super simples
  curl -sfL https://get.k3s.io | sh -
  - âœ… Inclui tudo que vocÃª precisa (container runtime, network, storage)
  - âœ… Usa menos recursos (512MB RAM vs 2GB do K8s completo)
  - âœ… Ideal para edge computing e pequenos clusters

  OpÃ§Ã£o C: MicroK8s (Canonical/Ubuntu)

  snap install microk8s --classic
  microk8s enable dns storage ingress

  OpÃ§Ã£o D: RKE2 (Rancher) - ProduÃ§Ã£o Enterprise

  - Kubernetes hardened para seguranÃ§a
  - Compliance com padrÃµes CIS

  ---
  ğŸ“¦ Stack Completo para Bare-Metal

  Camada 1: Infraestrutura Base

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Ubuntu Server 22.04 LTS           â”‚
  â”‚   - Docker/containerd               â”‚
  â”‚   - Networking (firewall, iptables) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Camada 2: Kubernetes

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Kubernetes Cluster                â”‚
  â”‚   - Control Plane (master nodes)    â”‚
  â”‚   - Worker Nodes                    â”‚
  â”‚   - etcd (key-value store)          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Camada 3: Networking

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   CNI Plugin (escolha um)           â”‚
  â”‚   - Calico (recomendado)            â”‚
  â”‚   - Flannel (simples)               â”‚
  â”‚   - Cilium (avanÃ§ado, eBPF)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Camada 4: Storage

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Storage Solution                  â”‚
  â”‚   - Longhorn (recomendado)          â”‚
  â”‚   - OpenEBS                         â”‚
  â”‚   - Rook-Ceph (complexo)            â”‚
  â”‚   - NFS Provisioner (simples)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Camada 5: Ingress & Load Balancer

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Ingress Controller                â”‚
  â”‚   - NGINX Ingress                   â”‚
  â”‚   - Traefik                         â”‚
  â”‚                                     â”‚
  â”‚   Load Balancer (tipo LoadBalancer) â”‚
  â”‚   - MetalLB (bare-metal LB)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ---
  ğŸ”§ Setup Completo: Exemplo com K3s

  1. Preparar o Servidor

  # Atualizar sistema
  apt update && apt upgrade -y

  # Instalar dependÃªncias
  apt install -y curl wget git

  # Desabilitar swap (K8s nÃ£o gosta)
  swapoff -a
  sed -i '/ swap / s/^/#/' /etc/fstab

  2. Instalar K3s

  # Master node
  curl -sfL https://get.k3s.io | sh -s - \
    --write-kubeconfig-mode 644 \
    --disable traefik \
    --disable servicelb

  # Pegar token para workers
  cat /var/lib/rancher/k3s/server/node-token

  # Worker nodes (se tiver mais de 1 servidor)
  curl -sfL https://get.k3s.io | K3S_URL=https://MASTER_IP:6443 \
    K3S_TOKEN=SEU_TOKEN sh -

  3. Instalar MetalLB (Load Balancer)

  kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.14.0/config/manifests/metallb-native.yaml

  # Configurar pool de IPs
  cat <<EOF | kubectl apply -f -
  apiVersion: metallb.io/v1beta1
  kind: IPAddressPool
  metadata:
    name: default-pool
    namespace: metallb-system
  spec:
    addresses:
    - 192.168.1.100-192.168.1.110  # IPs pÃºblicos/privados do seu servidor
  ---
  apiVersion: metallb.io/v1beta1
  kind: L2Advertisement
  metadata:
    name: default
    namespace: metallb-system
  EOF

  4. Instalar NGINX Ingress

  kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/baremetal/deploy.yaml

  5. Instalar Storage (Longhorn)

  kubectl apply -f https://raw.githubusercontent.com/longhorn/longhorn/v1.5.3/deploy/longhorn.yaml

  ---
  ğŸ”„ MudanÃ§as no Workflow CI/CD

â— Read(devops-ia-fork/.github/workflows/encontros-tech-cicd.yaml)
  â¿ Â Read 45 lines

â— VersÃ£o Bare-Metal do Deploy Job:

  deploy:
    name: Deploy to Kubernetes
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'
    environment:
      name: production
      url: http://SEU_IP_BARE_METAL  # IP fixo do seu servidor

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # âŒ REMOVE: Install doctl (nÃ£o precisa mais)
      # âŒ REMOVE: Save kubeconfig com doctl

      # âœ… NOVO: Configure kubectl com kubeconfig manual
      - name: Configure kubectl
        run: |
          mkdir -p ~/.kube
          echo "${{ secrets.KUBECONFIG_BASE64 }}" | base64 -d > ~/.kube/config
          chmod 600 ~/.kube/config

          # Testar conexÃ£o
          kubectl cluster-info
          kubectl get nodes

      - name: Update deployment image
        working-directory: ${{ env.WORKING_DIR }}
        run: |
          kubectl set image deployment/encontros-tech \
            encontros-tech=${{ env.DOCKER_IMAGE }}:latest

      - name: Wait for rollout
        run: |
          kubectl rollout status deployment/encontros-tech --timeout=5m

      - name: Verify deployment
        run: |
          kubectl get pods -l app=encontros-tech
          kubectl get service encontros-tech

      - name: Run post-deployment tests
        run: |
          # âœ… MUDANÃ‡A: IP fixo ao invÃ©s de LoadBalancer dinÃ¢mico
          export SERVICE_URL="http://SEU_IP_BARE_METAL"
          echo "Testing application at $SERVICE_URL"
          curl -f $SERVICE_URL/ || exit 1

  ---
  ğŸ”‘ Secrets NecessÃ¡rios

  DigitalOcean (Atual)

  DIGITALOCEAN_ACCESS_TOKEN
  K8S_CLUSTER_ID
  DOCKER_USERNAME
  DOCKER_PASSWORD

  Bare-Metal (Novo)

  KUBECONFIG_BASE64          # â† NOVO: kubeconfig do cluster
  DOCKER_USERNAME
  DOCKER_PASSWORD

  Como gerar o KUBECONFIG_BASE64:
  # No servidor bare-metal com K3s
  cat /etc/rancher/k3s/k3s.yaml | base64 -w 0

  # OU com kubeadm
  cat ~/.kube/config | base64 -w 0

  # Cole o output como secret no GitHub

  ---
  âš–ï¸ ComparaÃ§Ã£o: DigitalOcean vs Bare-Metal

  | Aspecto                   | DigitalOcean Managed  | Bare-Metal Self-Hosted        |
  |---------------------------|-----------------------|-------------------------------|
  | Setup inicial             | 5 minutos âœ…           | 1-2 horas âš ï¸                  |
  | Gerenciamento             | DigitalOcean gerencia | VocÃª gerencia tudo            |
  | AtualizaÃ§Ãµes K8s          | AutomÃ¡ticas âœ…         | Manuais âš ï¸                    |
  | HA (Alta Disponibilidade) | IncluÃ­do âœ…            | VocÃª configura (3+ masters)   |
  | Load Balancer             | AutomÃ¡tico âœ…          | Precisa MetalLB âš ï¸            |
  | Persistent Storage        | IncluÃ­do âœ…            | Precisa Longhorn/Ceph âš ï¸      |
  | Backups                   | AutomÃ¡ticos âœ…         | VocÃª gerencia âš ï¸              |
  | Monitoramento             | Dashboard incluÃ­do âœ…  | Precisa instalar (Prometheus) |
  | Custo mensal              | ~$36/mÃªs              | Custo do servidor             |
  | Escalabilidade            | FÃ¡cil (click no UI) âœ… | Manual (adicionar nodes) âš ï¸   |
  | Controle total            | Limitado âš ï¸           | Total âœ…                       |
  | Complexidade              | Baixa âœ…               | Alta âš ï¸                       |

  ---
  ğŸ’° Quando Usar Bare-Metal?

  âœ… Use Bare-Metal SE:

  1. VocÃª jÃ¡ tem servidores fÃ­sicos/VMs disponÃ­veis
  2. Precisa de controle total sobre o cluster
  3. Tem requisitos especÃ­ficos de compliance/seguranÃ§a
  4. Tem equipe experiente em Kubernetes
  5. Quer economizar no longo prazo (muitos workloads)

  âœ… Use DigitalOcean (Cloud Managed) SE:

  1. Quer comeÃ§ar rÃ¡pido
  2. NÃ£o tem equipe grande de infraestrutura
  3. Prefere foco em desenvolvimento, nÃ£o em ops
  4. Quer escalabilidade fÃ¡cil
  5. Precisa de SLA e suporte

  ---
  ğŸš€ RecomendaÃ§Ã£o para Seu Caso

  Para aprendizado/bootcamp: DigitalOcean Ã© melhor âœ…
  - Foco em CI/CD, nÃ£o em gerenciar infraestrutura
  - Setup rÃ¡pido
  - Menos chance de problemas

  Para produÃ§Ã£o real:
  - Startup/SMB: DigitalOcean ou AWS EKS
  - Enterprise com infraestrutura existente: Bare-metal com Kubeadm ou RKE2
  - Edge/IoT: K3s em bare-metal

